# 📌 Endpoint: `PATCH /api/accounts/v1/profile/update-phone/verify/`

### 🎯 کاربرد:

این API برای تأیید کد OTP و تکمیل فرآیند تغییر شماره تلفن کاربر استفاده می‌شود. کاربر پس از دریافت کد 6 رقمی در پیامک، باید کد و شماره تلفن جدید را ارسال کند.

> این endpoint **مرحله دوم** در فرآیند تغییر شماره تلفن است و نیاز به **احراز هویت** دارد.

---

## 📋 شرایط استفاده

* ✅ فقط کاربران **(authenticated)** مجاز به استفاده هستند.
* ✅ شناسه باید **شماره تلفن معتبر ایرانی** باشد (نه ایمیل).
* ✅ شماره تلفن جدید باید **منحصر به فرد** باشد (قبلاً ثبت نشده).
* ✅ کد OTP باید **6 رقم عددی** و **معتبر** باشد.
* 🚦 این endpoint تحت **محدودیت نرخ (Rate Limiting)** است.

---

## 🔐 سطح دسترسی

| شرط                          | وضعیت                        |
| ---------------------------- | ---------------------------- |
| نیاز به لاگین؟               | ✅ بله (کاربران احراز هویت شده) |
| محدودیت نرخ (Throttle) فعال؟ | ✅ بله                        |

---

## 📨 درخواست

### ➤ Method: `PATCH`

### ➤ URL: `/api/accounts/v1/profile/update-phone/verify/`

---

### Headers

| کلید          | مقدار              |
| ------------- | ------------------ |
| Content-Type  | `application/json` |
| Authorization | `Bearer YOUR_TOKEN` |

---

### Body (JSON)

```json
{
  "identity": "09987654321",
  "otp": "123456"
}
```

| فیلد       | نوع    | الزامی؟ | توضیح                                        |
| ---------- | ------ | ------- | -------------------------------------------- |
| `identity` | string | ✅       | شماره تلفن جدید که باید تأیید شود            |
| `otp`      | string | ✅       | کد تأیید 6 رقمی دریافت شده از پیامک         |

---

## 🧪 نمونه‌های معتبر

#### ✅ تأیید شماره تلفن جدید:

```json
{ 
  "identity": "09123456789",
  "otp": "654321"
}
```

---

## ✅ پاسخ موفق

### ✔️ Status Code: `200 OK`

```json
{
  "detail": "شماره تلفن با موفقیت تغیر کرد."
}
```

---

## ❌ پاسخ‌های خطا

| کد وضعیت | توضیح                                | نمونه پاسخ                                                                                                      |
| -------- | ------------------------------------ | --------------------------------------------------------------------------------------------------------------- |
| `400`    | خطاهای اعتبارسنجی کد OTP یا شماره    | 👇 نمونه‌ها در ادامه                                                                                            |
| `401`    | کاربر احراز هویت نشده               | `{ "detail": "Authentication credentials were not provided." }`                                                 |
| `429`    | عبور از حد مجاز تعداد درخواست        | `{ "detail": "شما بیش از حد مجاز درخواست ارسال کرده‌اید.", "available_in_seconds": 42 }`                      |
| `500`    | خطای داخلی سرور یا مشکل غیرمنتظره    | `{ "detail": "خطای ناشناخته‌ای رخ داده است. لطفاً دوباره تلاش کنید." }`                                         |

---

### 📉 نمونه پاسخ 400

#### ❗ عدم ارسال شناسه:

```json
{
  "identity": ["وارد کردن ایمیل یا شماره تلفن الزامی است."]
}
```

#### ❗ شناسه خالی:

```json
{
  "identity": ["لطفاً ایمیل یا شماره تلفن را وارد کنید."]
}
```

#### ❗ شماره تلفن نامعتبر:

```json
{
  "identity": ["ورودی نامعتبر است. لطفاً یک ایمیل یا شماره تلفن معتبر وارد کنید."]
}
```

#### ❗ شماره تکراری:

```json
{
  "identity": ["این شماره قبلاً ثبت شده است."]
}
```

#### ❗ عدم ارسال کد OTP:

```json
{
  "otp": ["کد تایید الزامی است."]
}
```

#### ❗ کد OTP خالی:

```json
{
  "otp": ["کد تایید نمی‌تواند خالی باشد."]
}
```

#### ❗ کد OTP کوتاه یا بلند:

```json
{
  "otp": ["کد تایید باید 6 رقم باشد."]
}
```

#### ❗ کد OTP غیرعددی:

```json
{
  "otp": ["کد تأیید باید فقط شامل ارقام باشد."]
}
```

#### ❗ کد تایید منقضی شده:

```json
{
  "otp": ["کد منقضی شده است. لطفاً دوباره درخواست دهید."]
}
```

#### ❗ کد نادرست:

```json
{
  "otp": ["کد وارد شده نادرست است."]
}
```

---
