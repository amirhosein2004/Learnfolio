# 📌 Endpoint: `POST /api/auth/submit-identity/`

### توضیحات
این Endpoint برای دریافت شناسه‌ی کاربر (ایمیل یا شماره موبایل ایرانی) طراحی شده و پس از بررسی، یک **کد تأیید (OTP)** یا **لینک تأیید** برای کاربر ارسال می‌کند:

- اگر ورودی **ایمیل** باشد، لینک یا کد از طریق **ایمیل** ارسال می‌شود.
- اگر ورودی **شماره موبایل** باشد، کد از طریق **پیامک** ارسال خواهد شد.
- برای جلوگیری از سوءاستفاده، محدودیت نرخ (Rate Limiting) برای این درخواست فعال است.
- کپچای Cloudflare Turnstile باید در هر درخواست ارسال شود.

---

## 📨 Request

- **Method**: `POST`  
- **URL**: `{{base_url}}/api/auth/submit-identity/`

### Headers

| کلید           | مقدار            |
|----------------|------------------|
| Content-Type   | application/json |

---

### Body (raw, JSON)

```json
{
  "identity": "09380186731",
  "cf-turnstile-response": "TOKEN_FROM_CLIENT"
}
````
📌 نکته: فیلد cf-turnstile-response حاوی توکن کپچای Turnstile از سمت کلاینت است و اجباری می‌باشد.

📌 مقدار `identity` می‌تواند یکی از موارد زیر باشد:

* یک **شماره موبایل ایرانی** (فرمت: `09xxxxxxxxx`)
* یا یک **ایمیل معتبر**

---

### 🧪 نمونه‌های معتبر

#### شماره موبایل:

```json
{ 
  "identity": "09380186731", 
  "cf-turnstile-response": "TOKEN" 
}
```

#### ایمیل:

```json
{ 
  "identity": "example@example.com", 
  "cf-turnstile-response": "TOKEN" 
}
```

---

## ✅ پاسخ موفق

* **کد وضعیت**: `200 OK`
* **بدنه پاسخ**:

اگر ورودی موبایل باشد:

```json
{
  "detail": "کد تایید به شماره موبایل شما ارسال شد."
}
```

اگر ورودی ایمیل باشد:

```json
{
  "detail": "لینک تایید به ایمیل شما ارسال شد."
}
```

---

## ❌ پاسخ‌های خطا

| کد وضعیت | توضیح خطا                                               | بدنه پاسخ مثال                                                                                                                         |
| -------- | ------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| `400`    | ورودی نامعتبر (ایمیل یا شماره اشتباه)<br>یا کپچا ناموفق | `{ "detail": "اعتبارسنجی کپچا ناموفق بود." }`<br>`{ "identity": ["ورودی نامعتبر است. لطفاً یک ایمیل یا شماره تلفن معتبر وارد کنید"] }` |
| `429`    | بیش از حد مجاز (Rate limiting)                          | `{ "detail": "درخواست‌های شما بیش از حد مجاز است. لطفا کمی صبر کنید." }`                                                               |
| `500`    | خطای سرور (خطای ناشناخته)                               | `{ "detail": "خطای ناشناخته‌ای رخ داده است لطفا دوباره تلاش کنید" }`                                                                   ||