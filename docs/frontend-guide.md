# 📖 راهنمای فرانت‌اند برای پروژه Learnfolio

این سند شامل راهنمایی‌های کلیدی برای توسعه‌دهندگان فرانت‌اند است که با بک‌اند این پروژه در تعامل هستند.

---

## 🚀 راه‌اندازی اولیه پروژه

برای راه‌اندازی کامل پروژه در محیط توسعه (شامل بک‌اند، دیتابیس و سایر سرویس‌ها) با استفاده از Docker، لطفاً به مستندات اصلی راه‌اندازی مراجعه کنید:

**[راهنمای کامل راه‌اندازی پروژه (setup.md)](./setup.md)**

---

## 🔑 مدیریت توکن‌های JWT

سیستم احراز هویت پروژه بر پایه توکن‌های JWT (Access Token و Refresh Token) کار می‌کند. در ادامه، جزئیات و نحوه مدیریت آن‌ها توضیح داده شده است.

### ساختار توکن‌ها

- **Access Token**: توکنی با عمر کوتاه است که برای دسترسی به APIهای نیازمند احراز هویت استفاده می‌شود.
  - **طول عمر:** **۱۵ دقیقه**
  - **نحوه ارسال:** این توکن باید در هدر `Authorization` تمام درخواست‌ها به شکل `Bearer <access_token>` ارسال شود.

- **Refresh Token**: توکنی با عمر طولانی است که برای دریافت یک Access Token جدید پس از منقضی شدن توکن قبلی به کار می‌رود.
  - **طول عمر:** **۷ روز**
  - **چرخش (Rotation):** **فعال است.** با هر بار استفاده از Refresh Token برای دریافت Access Token جدید، یک Refresh Token جدید نیز صادر می‌شود و توکن قبلی باطل می‌گردد. این کار امنیت را افزایش می‌دهد.
  - **نحوه ذخیره‌سازی:** به دلیل حساسیت بالا، Refresh Token باید در مکانی امن مانند `HttpOnly Cookie` ذخیره شود تا از دسترسی اسکریپت‌های مخرب (XSS) در امان بماند.

### فرآیند احراز هویت و تمدید توکن

1.  **ورود کاربر:** پس از ورود موفق کاربر، بک‌اند یک `Access Token` و یک `Refresh Token` برمی‌گرداند.
2.  **ذخیره‌سازی توکن‌ها:**
    - `Access Token` را در حافظه (memory) یا `localStorage` ذخیره کنید.
    - `Refresh Token` را در `HttpOnly Cookie` ذخیره کنید.
3.  **ارسال درخواست‌های احراز هویت شده:** در هر درخواست به APIهای محافظت‌شده، `Access Token` را در هدر `Authorization` قرار دهید.
4.  **مدیریت خطای 401 (Unauthorized):**
    - هنگامی که یک درخواست با خطای `401` مواجه می‌شود، به این معناست که `Access Token` منقضی شده است.
    - در این حالت، باید یک درخواست به اندپوینت تمدید توکن (`/api/accounts/v1/auth/token/refresh/`) ارسال کنید. در این درخواست، `Refresh Token` (که در کوکی ذخیره شده) به صورت خودکار توسط مرورگر ارسال می‌شود.
5.  **دریافت توکن جدید:**
    - اگر `Refresh Token` معتبر باشد، بک‌اند یک `Access Token` و یک `Refresh Token` جدید برمی‌گرداند.
    - توکن‌های جدید را جایگزین توکن‌های قبلی کنید.
    - درخواستی که با خطای 401 مواجه شده بود را مجدداً با `Access Token` جدید ارسال کنید.
6.  **خروج کاربر (Logout):**
    - برای خروج، `Access Token` را از حافظه پاک کنید و یک درخواست به اندپوینت خروج (`/api/accounts/v1/auth/logout/`) ارسال کنید تا `Refresh Token` در سمت سرور باطل شود.

---

## 🌐 لیست Endpoint های اصلی احراز هویت

تمامی آدرس‌های زیر با پیشوند `/api/accounts/v1/auth/` در دسترس هستند:

- `POST /submit-identity/`: ارسال ایمیل یا شماره موبایل برای دریافت کد/لینک تایید.
- `POST /verify-otp/`: تایید کد ۶ رقمی ارسال شده.
- `POST /verify-link/`: تایید لینک ارسال شده به ایمیل.
- `POST /resend-otp-or-link/`: ارسال مجدد کد یا لینک.
- `POST /login-password/`: ورود با استفاده از رمز عبور.
- `POST /token/refresh/`: دریافت Access Token جدید با استفاده از Refresh Token.
- `POST /logout/`: خروج کاربر و باطل کردن Refresh Token.

### 🔑 لیست Endpoint های مدیریت رمز عبور

تمامی آدرس‌های زیر با پیشوند `/api/accounts/v1/password/` در دسترس هستند:

- `POST /request-password-reset/`: ارسال شناسه برای دریافت کد/لینک بازنشانی.
- `POST /verify-otp/`: تایید کد OTP برای بازنشانی رمز عبور.
- `POST /verify-link/`: تایید لینک ایمیل برای بازنشانی رمز عبور.
- `POST /reset-password/`: تنظیم رمز عبور جدید با توکن بازنشانی.
- `POST /change-password/`: تغییر رمز عبور کاربر لاگین شده.
- `POST /first-time-password/`: تنظیم رمز عبور برای اولین بار.



برای مشاهده جزئیات کامل هر Endpoint (شامل پارامترها و پاسخ‌ها)، به مستندات Swagger UI پروژه مراجعه کنید.

---

## 👤 مدیریت پروفایل

این بخش شامل Endpoint‌های مربوط به مدیریت پروفایل کاربر و ادمین می‌شود.

### 🔒 Endpoint‌های پروفایل کاربر

تمامی آدرس‌های زیر با پیشوند `/api/accounts/v1/profile/` در دسترس هستند:

- `GET /me/`: دریافت اطلاعات پروفایل کاربر جاری
- `PATCH /me/`: به‌روزرسانی نام و نام خانوادگی کاربر
- `DELETE /me/`: حذف حساب کاربری

### 🔄 به‌روزرسانی اطلاعات هویتی

- `PATCH /update-identity/`: درخواست تغییر ایمیل یا شماره تلفن
- `PATCH /update-phone/verify/`: تایید کد OTP برای تغییر شماره تلفن
- `GET /update-email/confirm/`: تایید لینک تغییر ایمیل

### 👨‍💼 Endpoint‌های پروفایل ادمین

- `GET /admin/me/`: دریافت اطلاعات پروفایل ادمین
- `PATCH /admin/me/`: به‌روزرسانی پروفایل ادمین

### نکات مهم

1. تمامی درخواست‌های مربوط به پروفایل نیاز به احراز هویت دارند و باید حتماً توکن معتبر در هدر `Authorization` ارسال شود.
2. برای تغییر ایمیل، لینک تایید به آدرس ایمیل جدید ارسال می‌شود.
3. برای تغییر شماره تلفن، کد تایید به شماره جدید ارسال می‌شود.
4. در صورت بروز هرگونه خطا، پیام مناسب به همراه کد وضعیت مناسب برگردانده می‌شود.

برای مشاهده جزئیات کامل هر Endpoint (شامل پارامترها، پاسخ‌ها و کدهای وضعیت)، به مستندات Swagger UI پروژه مراجعه کنید.

---

## 📝 مدیریت مقالات (Blog)

این بخش شامل Endpoint‌های مربوط به مدیریت مقالات می‌شود.

### 🌐 لیست Endpoint های مقالات

تمامی آدرس‌های زیر با پیشوند `/api/blog/v1/blogs/` در دسترس هستند:

- `GET /`: دریافت لیست تمام مقالات با قابلیت جستجو و صفحه‌بندی
- `GET /{slug}/`: دریافت جزئیات کامل یک مقاله خاص با استفاده از slug
- `POST /`: ایجاد مقاله جدید (فقط ادمین)
- `PUT /{slug}/`: ویرایش کامل مقاله (فقط ادمین)
- `PATCH /{slug}/`: ویرایش جزئی مقاله (فقط ادمین)
- `DELETE /{slug}/`: حذف مقاله (فقط ادمین)

### نکات مهم

1. **دسترسی عمومی**: اندپوینت‌های `GET` نیاز به احراز هویت ندارند و همه کاربران می‌توانند مقالات را مشاهده کنند.
2. **دسترسی ادمین**: اندپوینت‌های `POST`، `PUT`، `PATCH` و `DELETE` فقط برای کاربران ادمین (staff) در دسترس هستند.
3. **شناسایی با Slug**: برای دسترسی به مقاله خاص از slug استفاده می‌شود، نه ID.
4. **صفحه‌بندی**: لیست مقالات به صورت صفحه‌بندی شده برگردانده می‌شود (۵ مقاله در هر صفحه).
5. **جستجو**: امکان جستجو در عنوان مقالات با پارامتر `search` وجود دارد.

### 📄 نکته مهم برای فرانت‌کار - Pagination

برای پیاده‌سازی صفحه‌بندی در فرانت‌اند، از فیلدهای زیر در پاسخ API استفاده کنید:

- **`count`**: تعداد کل مقالات
- **`next`**: لینک صفحه بعدی (null اگر وجود نداشته باشد)
- **`previous`**: لینک صفحه قبلی (null اگر وجود نداشته باشد)
- **`results`**: آرایه مقالات صفحه فعلی

برای ایجاد دکمه "موارد بیشتر" یا "صفحه بعدی"، بررسی کنید که فیلد `next` مقدار `null` نداشته باشد. اگر `null` بود، یعنی این آخرین صفحه است.
